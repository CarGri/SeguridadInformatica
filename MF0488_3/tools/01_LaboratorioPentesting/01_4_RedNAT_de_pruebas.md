# Red entre varias máquinas virtuales

Configurar una red entre varias máquinas virtuales en VirtualBox usando la red NAT (Network Address Translation) es un proceso sencillo, pero ten en cuenta que la red NAT tradicional de VirtualBox no permite la comunicación directa entre máquinas virtuales. Para que las máquinas virtuales se puedan comunicar entre sí, es recomendable usar la opción de **NAT Network** (Red NAT) o **Host-Only Adapter**. Aquí te explicaré cómo configurarlas usando **NAT Network**.

### Pasos para Configurar una Red entre Máquinas Virtuales usando NAT Network:

1. **Crear una Red NAT**:
    1. Abre **VirtualBox** y ve a **Archivo > Preferencias > Red**.
    2. Selecciona la pestaña **Red NAT** y haz clic en el ícono de `+` (Agregar una red NAT).
    3. Puedes dejar el nombre por defecto o darle uno nuevo. Asegúrate de que la red esté habilitada y configurada correctamente.
    4. Opcionalmente, puedes configurar los detalles de la red, como el rango de direcciones IP, haciendo clic en el ícono de configuración (la llave inglesa).

2. **Configurar las Máquinas Virtuales**:
    1. Abre la configuración de cada una de tus máquinas virtuales en VirtualBox.
    2. Ve a la sección **Red** y selecciona **Adaptador 1**.
    3. Cambia el **Modo de Conexión** a **Red NAT**.
    4. En **Nombre**, selecciona la red NAT que creaste en el paso anterior.
    5. Repite estos pasos para las otras dos máquinas virtuales.

3. **Configurar las Direcciones IP (Opcional)**:
    - Por defecto, VirtualBox asignará automáticamente direcciones IP a las máquinas virtuales en la red NAT. Si necesitas asignar direcciones IP estáticas dentro del rango de la red NAT, puedes hacerlo desde dentro del sistema operativo de cada máquina virtual.
    - Para asignar una IP estática en una máquina virtual (ejemplo en Linux):
      ```bash
      sudo nano /etc/network/interfaces
      ```
      Configura la interfaz de red como sigue:
      ```bash
      auto eth0
      iface eth0 inet static
          address 192.168.XX.YY
          netmask 255.255.255.0
          gateway 192.168.XX.1
      ```
      Luego, reinicia la interfaz de red:
      ```bash
      sudo ifdown eth0 && sudo ifup eth0
      ```

4. **Verificar Conectividad**:
    - Inicia todas las máquinas virtuales.
    - Abre una terminal en una de las máquinas y usa `ping` para verificar la conectividad con las otras máquinas:
      ```bash
      ping 192.168.XX.YY
      ```
    - Si recibes respuestas, las máquinas están correctamente configuradas y pueden comunicarse entre sí.

### Consideraciones Adicionales:
- **Puertos y Firewall**: Asegúrate de que los firewalls en las máquinas virtuales permitan tráfico ICMP (para `ping`) y otros servicios que necesites.
- **SSH u otros servicios**: Si quieres acceder a servicios específicos como SSH, asegúrate de que estos servicios estén instalados y corriendo en las máquinas virtuales.

Con estos pasos, tus tres máquinas virtuales deberían estar en red y capaces de comunicarse entre sí en el entorno NAT Network de VirtualBox.

## Probando conexiones

- Puedes usar el comando ``ipconfig`` par verificar la conexión de tus máquinas a la red NAT, verificando en cada una que esté dentro del rango de IPs de la red.

- Puedes verificar el reconocimiento de las máquinas usando el comando `ping` seguido de la dirección IP de la máquina que quieres verificar que esté dentro de la red.

- NMAP te puede verificar que máquinas están conectadas a la red: ``nmap 192.168.0.0/24``; que te devolverá un listado de las máquinas conectadas a la red y los puertos y servicios que se corren en cada una. Ejemplo de mi laboratorio actual:

  ```bash
  Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-12 09:04 EDT
  Nmap scan report for 192.168.0.1
  Host is up (0.00086s latency).
  Not shown: 999 closed tcp ports (conn-refused)
  PORT   STATE SERVICE
  53/tcp open  domain
  
  Nmap scan report for 192.168.0.7
  Host is up (0.0021s latency).
  Not shown: 999 closed tcp ports (conn-refused)
  PORT   STATE SERVICE
  22/tcp open  ssh
  
  Nmap scan report for 192.168.0.8
  Host is up (0.0023s latency).
  Not shown: 977 closed tcp ports (conn-refused)
  PORT     STATE SERVICE
  21/tcp   open  ftp
  22/tcp   open  ssh
  23/tcp   open  telnet
  25/tcp   open  smtp
  53/tcp   open  domain
  80/tcp   open  http
  111/tcp  open  rpcbind
  139/tcp  open  netbios-ssn
  445/tcp  open  microsoft-ds
  512/tcp  open  exec
  513/tcp  open  login
  514/tcp  open  shell
  1099/tcp open  rmiregistry
  1524/tcp open  ingreslock
  2049/tcp open  nfs
  2121/tcp open  ccproxy-ftp
  3306/tcp open  mysql
  5432/tcp open  postgresql
  5900/tcp open  vnc
  6000/tcp open  X11
  6667/tcp open  irc
  8009/tcp open  ajp13
  8180/tcp open  unknown
  
  Nmap scan report for 192.168.0.9
  Host is up (0.0012s latency).
  Not shown: 983 closed tcp ports (conn-refused)
  PORT     STATE SERVICE
  21/tcp   open  ftp
  22/tcp   open  ssh
  25/tcp   open  smtp
  80/tcp   open  http
  139/tcp  open  netbios-ssn
  443/tcp  open  https
  445/tcp  open  microsoft-ds
  512/tcp  open  exec
  513/tcp  open  login
  514/tcp  open  shell
  666/tcp  open  doom
  3306/tcp open  mysql
  5901/tcp open  vnc-1
  6001/tcp open  X11:1
  8080/tcp open  http-proxy
  8443/tcp open  https-alt
  9080/tcp open  glrpc
  
  Nmap done: 256 IP addresses (4 hosts up) scanned in 4.40 seconds
  
  ```

  *router virtual: 192.168.0.1*

  *máquina Kali: 192.168.0.7*

  *máquina Metasploitable2: 192.168.0.8*

  *máquina BeeBox: 192.168.0.9*

  …

  … verificar que máquinas están conectadas a la red y cuales son sus SO:

  ```bash
  $ sudo nmap -O 192.168.0.0/24 
  Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-12 09:30 EDT
  Nmap scan report for 192.168.0.1
  Host is up (0.00058s latency).
  Not shown: 999 closed tcp ports (reset)
  PORT   STATE SERVICE
  53/tcp open  domain
  MAC Address: 52:54:00:12:35:00 (QEMU virtual NIC)
  No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
  TCP/IP fingerprint:
  OS:SCAN(V=7.94SVN%E=4%D=8/12%OT=53%CT=1%CU=38786%PV=Y%DS=1%DC=D%G=Y%M=52540
  OS:0%TM=66BA0E86%P=x86_64-pc-linux-gnu)SEQ(SP=0%GCD=518%ISR=6D%TI=I%CI=I%II
  OS:=RI%SS=O%TS=U)SEQ(SP=11%GCD=502%ISR=74%CI=I%II=RI%TS=U)SEQ(SP=3F%GCD=1%I
  OS:SR=75%TI=I%CI=I%II=RI%SS=O%TS=U)SEQ(SP=41%GCD=1%ISR=6D%TI=I%CI=I%II=RI%S
  OS:S=O%TS=U)SEQ(SP=64%GCD=1%ISR=6F%CI=I%II=RI%TS=U)OPS(O1=M5B4%O2=M5B4%O3=M
  OS:5B4%O4=M5B4%O5=M5B4%O6=M5B4)WIN(W1=8000%W2=8000%W3=8000%W4=8000%W5=8000%
  OS:W6=8000)ECN(R=Y%DF=N%T=FF%W=8000%O=M5B4%CC=N%Q=)T1(R=Y%DF=N%T=FF%S=O%A=S
  OS:+%F=AS%RD=0%Q=)T2(R=N)T3(R=Y%DF=N%T=FF%W=8000%S=O%A=S+%F=AS%O=M5B4%RD=0%
  OS:Q=)T4(R=Y%DF=N%T=FF%W=8000%S=A%A=S%F=AR%O=%RD=0%Q=)T5(R=Y%DF=N%T=FF%W=80
  OS:00%S=A%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=N%T=FF%W=8000%S=A%A=S%F=AR%O=%RD=0
  OS:%Q=)T7(R=Y%DF=N%T=FF%W=8000%S=A%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=FF%IP
  OS:L=38%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=S%T=FF%CD=S)
  
  Network Distance: 1 hop
  
  Nmap scan report for 192.168.0.2
  Host is up (0.00072s latency).
  Not shown: 997 filtered tcp ports (no-response)
  PORT     STATE SERVICE
  135/tcp  open  msrpc
  445/tcp  open  microsoft-ds
  5989/tcp open  wbem-https
  MAC Address: 52:54:00:12:35:00 (QEMU virtual NIC)
  Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
  Device type: VoIP phone|webcam|specialized|general purpose
  Running (JUST GUESSING): Grandstream embedded (91%), Garmin embedded (88%), 2N embedded (87%), Cognex embedded (85%), lwIP (85%)
  OS CPE: cpe:/h:grandstream:gxp1105 cpe:/h:garmin:virb_elite cpe:/h:2n:helios cpe:/a:lwip_project:lwip
  Aggressive OS guesses: Grandstream GXP1105 VoIP phone (91%), Garmin Virb Elite action camera (88%), 2N Helios IP VoIP doorbell (87%), Cognex DataMan 200 ID reader (lwIP TCP/IP stack) (85%)
  No exact OS matches for host (test conditions non-ideal).
  Network Distance: 1 hop
  
  Nmap scan report for 192.168.0.3
  Host is up (0.00038s latency).
  All 1000 scanned ports on 192.168.0.3 are in ignored states.
  Not shown: 1000 filtered tcp ports (proto-unreach)
  MAC Address: 08:00:27:F4:F0:13 (Oracle VirtualBox virtual NIC)
  Too many fingerprints match this host to give specific OS details
  Network Distance: 1 hop
  
  Nmap scan report for 192.168.0.8
  Host is up (0.00068s latency).
  Not shown: 977 closed tcp ports (reset)
  PORT     STATE SERVICE
  21/tcp   open  ftp
  22/tcp   open  ssh
  23/tcp   open  telnet
  25/tcp   open  smtp
  53/tcp   open  domain
  80/tcp   open  http
  111/tcp  open  rpcbind
  139/tcp  open  netbios-ssn
  445/tcp  open  microsoft-ds
  512/tcp  open  exec
  513/tcp  open  login
  514/tcp  open  shell
  1099/tcp open  rmiregistry
  1524/tcp open  ingreslock
  2049/tcp open  nfs
  2121/tcp open  ccproxy-ftp
  3306/tcp open  mysql
  5432/tcp open  postgresql
  5900/tcp open  vnc
  6000/tcp open  X11
  6667/tcp open  irc
  8009/tcp open  ajp13
  8180/tcp open  unknown
  MAC Address: 08:00:27:D6:59:49 (Oracle VirtualBox virtual NIC)
  Device type: general purpose
  Running: Linux 2.6.X
  OS CPE: cpe:/o:linux:linux_kernel:2.6
  OS details: Linux 2.6.9 - 2.6.33
  Network Distance: 1 hop
  
  Nmap scan report for 192.168.0.9
  Host is up (0.00071s latency).
  Not shown: 983 closed tcp ports (reset)
  PORT     STATE SERVICE
  21/tcp   open  ftp
  22/tcp   open  ssh
  25/tcp   open  smtp
  80/tcp   open  http
  139/tcp  open  netbios-ssn
  443/tcp  open  https
  445/tcp  open  microsoft-ds
  512/tcp  open  exec
  513/tcp  open  login
  514/tcp  open  shell
  666/tcp  open  doom
  3306/tcp open  mysql
  5901/tcp open  vnc-1
  6001/tcp open  X11:1
  8080/tcp open  http-proxy
  8443/tcp open  https-alt
  9080/tcp open  glrpc
  MAC Address: 08:00:27:7A:9B:53 (Oracle VirtualBox virtual NIC)
  Device type: general purpose
  Running: Linux 2.6.X
  OS CPE: cpe:/o:linux:linux_kernel:2.6
  OS details: Linux 2.6.13 - 2.6.32
  Network Distance: 1 hop
  
  Nmap scan report for 192.168.0.10
  Host is up (0.00092s latency).
  Not shown: 999 filtered tcp ports (no-response)
  PORT   STATE SERVICE
  22/tcp open  ssh
  MAC Address: 08:00:27:10:B8:D0 (Oracle VirtualBox virtual NIC)
  Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
  Device type: general purpose
  Running (JUST GUESSING): Microsoft Windows 2008 (85%)
  OS CPE: cpe:/o:microsoft:windows_server_2008::beta3 cpe:/o:microsoft:windows_server_2008
  Aggressive OS guesses: Microsoft Windows Server 2008 or 2008 Beta 3 (85%)
  No exact OS matches for host (test conditions non-ideal).
  Network Distance: 1 hop
  
  Nmap scan report for 192.168.0.7
  Host is up (0.000034s latency).
  Not shown: 999 closed tcp ports (reset)
  PORT   STATE SERVICE
  22/tcp open  ssh
  Aggressive OS guesses: Linux 2.6.32 (96%), Linux 3.7 - 3.10 (96%), Linux 3.11 - 3.14 (95%), Linux 3.19 (95%), Linux 3.8 (95%), Linux 3.8 - 4.14 (95%), Linux 3.16 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%)
  No exact OS matches for host (test conditions non-ideal).
  Network Distance: 0 hops
  
  OS detection performed. Please report any incorrect results at https://nmap.org/submit/ .
  Nmap done: 256 IP addresses (7 hosts up) scanned in 28.58 seconds
  
  ```

  